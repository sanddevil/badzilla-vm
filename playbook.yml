---

- hosts: all
  become: yes

  vars_files:
    - default.config.yml

  roles:

    - role: Oefenweb.php-cli-ondrej
      php_cli_ondrej_version: 7.2
      php_cli_ondrej_update_alternatives: true
      php_cli_ondrej_mods_present:
        - name: json
        - name: xml
        - name: readline
        - name: mysql
        - name: memcached
        - name: msgpack
        - name: mbstring
        - name: gd
        - name: curl
      php_cli_ondrej_install:
        -  php7.2-xdebug
        -  php7.2-fpm 

    - role: Oefenweb.php-cli-ondrej
      php_cli_ondrej_version: 7.1
      php_cli_ondrej_update_alternatives: true   
      php_cli_ondrej_install:
        -  php7.1-xdebug   
        -  php7.1-fpm   

    - role: Oefenweb.php-cli-ondrej
      php_cli_ondrej_version: 7.0
      php_cli_ondrej_update_alternatives: true  
      php_cli_ondrej_install:
        -  php7.0-xdebug    
        -  php7.0-fpm    

    - role: Oefenweb.php-cli-ondrej
      php_cli_ondrej_version: 5.6
      php_cli_ondrej_update_alternatives: true
      php_cli_ondrej_install:
        -  php5.6-xdebug
        -  php5.6-xhprof        
        -  php5.6-fpm


    - role: geerlingguy.nginx
    - role: TroodoNmike.nginx-conf
      nginx_conf_default_path: /etc/nginx/sites-available
      nginx_conf_default_port: 80


    - role: geerlingguy.memcached
    - role: geerlingguy.nodejs

    - role: geerlingguy.mysql
      mysql_packages:
        - mariadb-client
        - mariadb-server

    - role: geerlingguy.composer
      composer_keep_updated: true

    # See https://github.com/drush-ops/drush-launcher/issues/33 
    # on how to use drush on non-composer Drupal projects  
    - role: geerlingguy.drush
      drush_launcher_install: yes
      drush_launcher_version: "0.5.1"


  tasks: 

    # Set symlinks to nginx sites-available directory
    - name: Get a list of all vhosts
      find:
        paths: /etc/nginx/sites-available
        patterns: "*.conf"
        file_type: file
      register: find

    - name: Apply symlinks in sites-enabled
      file:
        dest: /etc/nginx/sites-enabled/{{ item.path | basename }}
        src: "{{ item.path }}"
        state: link
        force: yes
      with_items: "{{ find.files }}"




